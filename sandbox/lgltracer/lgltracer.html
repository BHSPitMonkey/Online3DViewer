<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="content-type" content="text/html;charset=utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no">

	<title>Online 3D Viewer</title>

	<script type="text/javascript" src="three.min.js"></script>
	<script type="text/javascript" src="RGBELoader.js"></script>
	<script type="text/javascript" src="GLTFLoader.js"></script>
	<script type="text/javascript" src="lglTracer.umd.js"></script>

	<style>
		html, body
		{
			margin: 0px;
			padding: 0px;
			width: 100%;
			height: 100%;
		}
	</style>

	<script type='text/javascript'>
		window.onload = function () {
			async function Load ()
			{
				const renderer = new LGLTracer.LGLTracerRenderer();
				document.body.appendChild(renderer.domElement);

				const scene = new THREE.Scene();

				const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight);
				camera.position.z = 4;

				const directionalLight = new LGLTracer.DirectionalLight(0xffffff, 1);
				directionalLight.position.y = 1;
				scene.add(directionalLight);

				console.log ('load environment');
				const rgbeLoader = new THREE.RGBELoader().setDataType(THREE.FloatType);
				const envMap = await new Promise(resolve => {
					rgbeLoader.load('gray-background-with-dirlight_1k.hdr', resolve);
				});
				scene.environment = envMap;

				console.log ('load model');
				const gltfLoader = new THREE.GLTFLoader();
				const gltfInfo = await new Promise(resolve => {
					gltfLoader.load('DamagedHelmet.glb', resolve);
				});
				scene.add(gltfInfo.scene);

				renderer.setSize(window.innerWidth, window.innerHeight);

				function tick() {
					console.log ('tick');
					renderer.render(scene, camera);
					requestAnimationFrame(tick);
				}

				console.log ('build scene');
				renderer.buildScene(scene, camera).then(() => {
					tick();
				});
			}
			Load ();
		};
	</script>
</head>

<body>

</body>

</html>
